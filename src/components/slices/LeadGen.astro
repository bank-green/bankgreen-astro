---
import { TextInput, Select, Button, Checkbox, Stack, Group, Text } from '@mantine/core';
import PrismicDOM from 'prismic-dom';

interface Props {
  primary?: {
    title?: any;
    show_bank_field?: boolean;
    show_status_field?: boolean;
    form_bank_label?: string;
    form_name_label?: string;
    form_email_label?: string;
    form_status_label?: string;
    button_label?: string;
  };
  items?: Array<{
    bullet_text?: any;
    dropdown_status_option?: string;
  }>;
  slice_type?: string;
}

const { primary, items = [], slice_type } = Astro.props as Props;

const title = primary?.title ? PrismicDOM.RichText.asText(primary.title) : 'Curious about switching to a green bank?';
const showBankField = primary?.show_bank_field ?? true;
const showStatusField = primary?.show_status_field ?? true;

// Extract bullet points
const bulletPoints = items
  .map((item) => (item.bullet_text ? PrismicDOM.RichText.asText(item.bullet_text) : ''))
  .filter((text) => text.length > 0);

// Extract status options
const statusOptions = items
  .map((item) => item.dropdown_status_option)
  .filter((opt): opt is string => typeof opt === 'string' && opt !== 'Select none (default)');
---

<section data-slice-type={slice_type} aria-labelledby="lead-gen-title">
  <h2 id="lead-gen-title">{title}</h2>

  {bulletPoints.length > 0 && (
    <ul>
      {bulletPoints.map((point) => (
        <li>{point}</li>
      ))}
    </ul>
  )}

  <form>
    <Stack>
      {showBankField && (
        <TextInput
          label={primary?.form_bank_label || 'I am interested in'}
          placeholder="Search for a bank..."
          name="bank"
          id="bank"
        />
      )}

      <TextInput
        label={primary?.form_name_label || 'First name'}
        placeholder="First name, so we can say hi"
        name="firstName"
        id="firstName"
      />

      <TextInput
        type="email"
        label={primary?.form_email_label || 'Email address'}
        placeholder="Your email address"
        name="email"
        id="email"
        required
      />

      {showStatusField && statusOptions.length > 0 && (
        <Select
          label={primary?.form_status_label || 'Which option best describes your current status?'}
          placeholder="Select an option..."
          name="status"
          id="status"
          data={statusOptions}
        />
      )}

      <Checkbox
        label="I wish to receive more information via email from Bank.Green."
        name="isAgreeMarketing"
      />

      <Checkbox
        label="I have read and understood Bank.Green's privacy policy."
        name="isAgreeTerms"
        required
      />

      <Group>
        <Button type="submit" variant="filled">
          {primary?.button_label || 'Complete Sign Up'}
        </Button>
      </Group>
    </Stack>
  </form>
</section>
