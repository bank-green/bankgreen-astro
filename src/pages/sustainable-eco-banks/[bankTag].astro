---
import { BankProfilePage } from '@components/pages'
import BaseLayout from '@layouts/BaseLayout.astro'
import { fetchBrandByTag } from '@lib/queries/brands'

interface BankData {
  name: string
  tag: string
  website?: string | null
  commentary?: {
    rating?: string | null
    lastReviewed?: string | null
    headline?: string | null
    description1?: string | null
    description2?: string | null
    description3?: string | null
    fossilFreeAlliance?: boolean | null
    showOnSustainableBanksPage?: boolean
  } | null
  countries?: Array<{ code: string }> | null
}
export async function getStaticPaths() {
  // TODO: Fetch all sustainable banks from GraphQL
  // const data = await graphqlFetch(`query { sustainableBanks { tag } }`);
  // return data.sustainableBanks.map((bank) => ({ params: { bankTag: bank.tag } }));
  return []
}

const { bankTag } = Astro.params

// Fetch bank data from GraphQL
const bank = await fetchBrandByTag(bankTag as string)

// Redirect to 404 if bank not found
if (!bank) {
  return Astro.redirect('/404')
}

const bankName = bank.name
const title = `${bankName} Review`
---

<BaseLayout title={title}>
  <BankProfilePage bank={bank} client:load />
</BaseLayout>
