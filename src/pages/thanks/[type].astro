---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getByUIDSafe, thanksPagesMap, thanksPagesFallback } from "@lib/prismic";

export function getStaticPaths() {
  // Generate paths for all known thank you page types
  return Object.keys(thanksPagesMap).map((type) => ({
    params: { type },
  }));
}

const { type } = Astro.params;
const pageType = type || "thanks";

const mapping = thanksPagesMap[pageType];
const fallback = thanksPagesFallback[pageType];

if (!mapping || !fallback) {
  return Astro.redirect("/404");
}

let page = null;
if (mapping.type === "thankspages") {
  page = await getByUIDSafe("thankspages", mapping.uid);
} else if (mapping.type === "textonlypages") {
  page = await getByUIDSafe("textonlypages", mapping.uid);
}

const title = page?.data?.head_helper_title || fallback.title;
---

<BaseLayout title="Thank You">
  <article>
    <header>
      <h1>{title}</h1>
      {fallback.description && <p>{fallback.description}</p>}
    </header>

    <section>
      {/* SliceZone content from page?.data?.slices if available */}
    </section>

    {pageType !== "donate-cancelled" && pageType !== "updates-no" && (
      <section>
        <h2>Explore More</h2>
        <ul>
          <li><a href="/sustainable-eco-banks">Find a sustainable bank</a></li>
          <li><a href="/blog">Read our blog</a></li>
          <li><a href="/take-action">Take action</a></li>
        </ul>
      </section>
    )}
  </article>
</BaseLayout>
