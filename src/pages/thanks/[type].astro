---
import { ThanksPage } from '@components/pages'
import BaseLayout from '@layouts/BaseLayout.astro'
import { getByUIDSafe, thanksPagesFallback, thanksPagesMap } from '@lib/prismic'

export function getStaticPaths() {
  return Object.keys(thanksPagesMap).map((type) => ({
    params: { type },
  }))
}

const { type } = Astro.params
const pageType = type || 'thanks'

const mapping = thanksPagesMap[pageType]
const fallback = thanksPagesFallback[pageType]

if (!mapping || !fallback) {
  return Astro.redirect('/404')
}

let page = null
if (mapping.type === 'thankspages') {
  page = await getByUIDSafe('thankspages', mapping.uid)
} else if (mapping.type === 'textonlypages') {
  page = await getByUIDSafe('textonlypages', mapping.uid)
}
---

<BaseLayout title="Thank You">
  <ThanksPage page={page} fallback={fallback} pageType={pageType} client:load />
</BaseLayout>
